<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Draft21 - ×›×œ×™ ×“×¨××¤×˜ ×›×“×•×¨×’×œ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .animate-bounce {
      animation: bounce 1s infinite;
    }
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-20px); }
    }
    
    .animate-pulse {
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .confetti {
      position: fixed;
      animation: fall 3s linear;
      pointer-events: none;
      font-size: 24px;
      z-index: 9999;
    }
    @keyframes fall {
      to { transform: translateY(100vh) rotate(360deg); opacity: 0; }
    }
  </style>
</head>
<body class="min-h-screen">
  <div id="app"></div>

  <script>
    let gameState = {
      status: 'setup',
      players: [],
      teams: [],
      participants: [],
      picks: [],
      turn: { order: [], index: 0, direction: 1 },
      settings: { snake: true, randomOrder: false }
    };

    let state = {
      phase: 'setup',
      playerInput: '',
      nickname: '',
      myId: '',
      isHost: false,
      selectedCaptains: [],
      teamAssignments: {},
      listeners: [],
      draftOrder: [],
      manualOrder: false
    };

    const TEAM_COLORS = {
      Red: { bg: 'bg-red-500', class: 'red' },
      White: { bg: 'bg-gray-100', class: 'white' },
      Black: { bg: 'bg-gray-900', class: 'black' }
    };

    function notifyListeners() {
      state.listeners.forEach(callback => callback(gameState));
    }

    function subscribeToGame(callback) {
      state.listeners.push(callback);
      callback(gameState);
    }

    function init() {
      const storedNickname = localStorage.getItem('draft21_nickname');
      const storedId = localStorage.getItem('draft21_id');
      
      if (storedNickname && storedId) {
        state.nickname = storedNickname;
        state.myId = storedId;
      }

      subscribeToGame((data) => {
        state.phase = data.status || 'setup';
        render();
      });
    }

    function cleanPlayerNames(text) {
      return text
        .split('\n')
        .map(line => {
          let cleaned = line.trim();
          cleaned = cleaned.replace(/^\d+[\.\)\-\s]+/, '');
          cleaned = cleaned.replace(/[\d\.\)\-]+$/, '');
          cleaned = cleaned.replace(/\d+/g, '');
          return cleaned.trim();
        })
        .filter(name => name.length > 0)
        .slice(0, 21);
    }

    function initializeGame() {
      const names = cleanPlayerNames(state.playerInput);
      if (names.length === 0) return;

      const players = names.map((name, idx) => ({
        id: 'player_' + idx,
        name: name,
        available: true
      }));

      gameState = {
        status: 'captains',
        players: players,
        teams: [],
        participants: [],
        picks: [],
        turn: { order: [], index: 0, direction: 1 },
        settings: { snake: true, randomOrder: false }
      };

      state.isHost = true;
      notifyListeners();
    }

    function toggleCaptain(playerId) {
      const idx = state.selectedCaptains.indexOf(playerId);
      if (idx > -1) {
        state.selectedCaptains.splice(idx, 1);
      } else if (state.selectedCaptains.length < 3) {
        state.selectedCaptains.push(playerId);
      }
      render();
    }

    function selectCaptainsRandomly() {
      const availablePlayers = gameState.players.filter(p => p.available);
      const shuffled = availablePlayers.slice().sort(() => Math.random() - 0.5);
      state.selectedCaptains = shuffled.slice(0, 3).map(p => p.id);
      
      const colors = ['Red', 'White', 'Black'];
      state.teamAssignments = {};
      state.selectedCaptains.forEach((captainId, idx) => {
        state.teamAssignments[captainId] = colors[idx];
      });
      render();
    }

    function assignTeam(captainId, color) {
      state.teamAssignments[captainId] = color;
      render();
    }

    function finalizeCaptains() {
      if (state.selectedCaptains.length !== 3 || Object.keys(state.teamAssignments).length !== 3) return;

      const teams = state.selectedCaptains.map(captainId => {
        const captain = gameState.players.find(p => p.id === captainId);
        return {
          name: state.teamAssignments[captainId],
          captain: captain.name,
          captainId: captainId,
          players: [captain.name]
        };
      });

      const updatedPlayers = gameState.players.map(p => ({
        id: p.id,
        name: p.name,
        available: !state.selectedCaptains.includes(p.id)
      }));

      gameState.teams = teams;
      gameState.players = updatedPlayers;
      gameState.status = 'lobby';
      notifyListeners();
    }

    function joinLobby() {
      if (!state.nickname.trim()) return;
      
      const participantId = state.myId || 'participant_' + Date.now();
      state.myId = participantId;
      localStorage.setItem('draft21_nickname', state.nickname);
      localStorage.setItem('draft21_id', participantId);

      const participant = {
        id: participantId,
        name: state.nickname,
        ready: false
      };

      const exists = gameState.participants.some(p => p.id === participantId);
      if (!exists) {
        gameState.participants.push(participant);
        notifyListeners();
      }
    }

    function toggleReady() {
      gameState.participants = gameState.participants.map(p =>
        p.id === state.myId ? { id: p.id, name: p.name, ready: !p.ready } : p
      );
      notifyListeners();
    }

    function startDraft() {
      const participants = gameState.participants.filter(p => p.ready);
      if (participants.length === 0) return;

      let order = [];
      
      if (state.manualOrder && state.draftOrder.length > 0) {
        const orderedParticipants = state.draftOrder.map(id => 
          participants.find(p => p.id === id)
        ).filter(p => p);
        
        const availableCount = gameState.players.filter(p => p.available).length;
        const rounds = Math.ceil(availableCount / orderedParticipants.length);
        
        for (let round = 0; round < rounds; round++) {
          if (round % 2 === 0) {
            order = order.concat(orderedParticipants.map(p => p.id));
          } else {
            order = order.concat(orderedParticipants.map(p => p.id).reverse());
          }
        }
      } else {
        const availableCount = gameState.players.filter(p => p.available).length;
        const rounds = Math.ceil(availableCount / participants.length);
        
        for (let round = 0; round < rounds; round++) {
          if (round % 2 === 0) {
            order = order.concat(participants.map(p => p.id));
          } else {
            order = order.concat(participants.map(p => p.id).reverse());
          }
        }
      }

      gameState.status = 'drafting';
      gameState.turn = { order: order, index: 0, direction: 1 };
      notifyListeners();
    }

    function toggleManualOrder() {
      state.manualOrder = !state.manualOrder;
      if (!state.manualOrder) {
        state.draftOrder = [];
      } else {
        const participants = gameState.participants.filter(p => p.ready);
        state.draftOrder = participants.map(p => p.id);
      }
      render();
    }

    function moveDraftOrder(participantId, direction) {
      const currentIndex = state.draftOrder.indexOf(participantId);
      if (currentIndex === -1) return;
      
      const newIndex = currentIndex + direction;
      if (newIndex < 0 || newIndex >= state.draftOrder.length) return;
      
      const temp = state.draftOrder[currentIndex];
      state.draftOrder[currentIndex] = state.draftOrder[newIndex];
      state.draftOrder[newIndex] = temp;
      
      render();
    }

    function randomizeDraftOrder() {
      state.draftOrder = state.draftOrder.slice().sort(() => Math.random() - 0.5);
      render();
    }

    function makePick(playerId) {
      const currentTurn = gameState.turn.order[gameState.turn.index];
      if (currentTurn !== state.myId) return;

      const player = gameState.players.find(p => p.id === playerId);
      if (!player || !player.available) return;

      const participant = gameState.participants.find(p => p.id === state.myId);
      const teamIndex = gameState.turn.index % 3;
      const team = gameState.teams[teamIndex];

      gameState.players = gameState.players.map(p =>
        p.id === playerId ? { id: p.id, name: p.name, available: false } : p
      );

      gameState.teams = gameState.teams.map(t =>
        t.name === team.name ? { name: t.name, captain: t.captain, captainId: t.captainId, players: t.players.concat([player.name]) } : t
      );

      const pick = {
        playerId: playerId,
        playerName: player.name,
        team: team.name,
        participant: participant.name,
        pickNumber: gameState.picks.length + 1,
        timestamp: Date.now()
      };
      gameState.picks.push(pick);

      gameState.turn.index++;

      const allPicked = gameState.players.filter(p => p.available).length === 0;
      if (allPicked) {
        gameState.status = 'completed';
      }

      notifyListeners();
      showConfetti();
    }

    function resetDraft() {
      gameState.picks = [];
      gameState.turn = { order: gameState.turn.order, index: 0, direction: 1 };
      gameState.status = 'drafting';
      gameState.players = gameState.players.map(p => ({
        id: p.id,
        name: p.name,
        available: !state.selectedCaptains.includes(p.id)
      }));
      gameState.teams = gameState.teams.map(t => ({
        name: t.name,
        captain: t.captain,
        captainId: t.captainId,
        players: [t.captain]
      }));
      notifyListeners();
    }

    function shareOnWhatsApp() {
      let message = 'âš½ ×ª×•×¦××•×ª ×”×“×¨××¤×˜:\n\n';
      
      gameState.teams.forEach((team) => {
        const color = team.name === 'Red' ? 'ğŸ”´' : team.name === 'White' ? 'âšª' : 'âš«';
        message += color + ' ×§×‘×•×¦×” ' + team.name + '\n';
        message += '×§×¤×˜×Ÿ: ' + team.captain + '\n';
        message += '×©×—×§× ×™×: ' + team.players.join(', ') + '\n\n';
      });

      const url = 'https://wa.me/?text=' + encodeURIComponent(message);
      window.open(url, '_blank');
    }

    function showConfetti() {
      for (let i = 0; i < 50; i++) {
        setTimeout(() => {
          const confetti = document.createElement('div');
          confetti.className = 'confetti';
          const emojis = ['ğŸ‰', 'âš½', 'ğŸ†', 'âœ¨', 'ğŸŠ'];
          confetti.textContent = emojis[Math.floor(Math.random() * emojis.length)];
          confetti.style.left = Math.random() * 100 + '%';
          confetti.style.top = '-50px';
          document.body.appendChild(confetti);
          setTimeout(() => confetti.remove(), 3000);
        }, i * 50);
      }
    }

    function getCurrentTurnInfo() {
      if (!gameState || state.phase !== 'drafting') return null;
      const currentParticipantId = gameState.turn.order[gameState.turn.index];
      const participant = gameState.participants.find(p => p.id === currentParticipantId);
      const teamIndex = gameState.turn.index % 3;
      const team = gameState.teams[teamIndex];
      return { participant: participant, team: team, isMyTurn: currentParticipantId === state.myId };
    }

    function render() {
      const app = document.getElementById('app');
      
      if (state.phase === 'setup' || !gameState.players.length) {
        app.innerHTML = renderSetup();
      } else if (state.phase === 'captains') {
        app.innerHTML = renderCaptains();
      } else if (state.phase === 'lobby') {
        app.innerHTML = renderLobby();
      } else if (state.phase === 'drafting') {
        app.innerHTML = renderDrafting();
      } else if (state.phase === 'completed') {
        app.innerHTML = renderCompleted();
      }
    }

    function renderSetup() {
      return '<div class="min-h-screen bg-gradient-to-br from-green-500 to-blue-600 p-4 flex items-center justify-center">' +
        '<div class="bg-white rounded-3xl shadow-2xl p-8 max-w-md w-full">' +
          '<div class="text-center mb-6">' +
            '<div class="text-6xl mb-4">ğŸ†</div>' +
            '<h1 class="text-4xl font-bold text-gray-800">Draft21</h1>' +
            '<p class="text-gray-600 mt-2">×›×œ×™ ×“×¨××¤×˜ ×›×“×•×¨×’×œ ×‘×–××Ÿ ×××ª</p>' +
          '</div>' +
          '<div class="space-y-4">' +
            '<div>' +
              '<label class="block text-sm font-medium text-gray-700 mb-2">×”×“×‘×§ ×¨×©×™××ª ×©×—×§× ×™× (×¢×“ 21)</label>' +
              '<textarea id="playerInput" placeholder="1. ×“×•×“&#10;2. ×™×•××‘&#10;3. ××œ×•×Ÿ&#10;4. ×¢×•××¨&#10;5. × ×•×¢×" class="w-full h-48 p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all"></textarea>' +
            '</div>' +
            '<button onclick="handleInitGame()" class="w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white py-4 rounded-xl font-bold text-lg hover:from-blue-600 hover:to-purple-700 transition-all transform hover:scale-105">×”×ª×—×œ ×”×’×“×¨×ª ×“×¨××¤×˜</button>' +
          '</div>' +
        '</div>' +
      '</div>';
    }

    function renderCaptains() {
      const selectedCount = state.selectedCaptains.length;
      const assignedCount = Object.keys(state.teamAssignments).length;
      
      let html = '<div class="min-h-screen bg-gradient-to-br from-purple-500 to-pink-600 p-4">' +
        '<div class="max-w-4xl mx-auto">' +
          '<div class="bg-white rounded-3xl shadow-2xl p-8 mb-6">' +
            '<h2 class="text-3xl font-bold text-gray-800 mb-2">×‘×—×¨ 3 ×§×¤×˜× ×™×</h2>' +
            '<p class="text-gray-600 mb-6">×œ×—×¥ ×¢×œ ×©×—×§× ×™× ××• ×”×’×¨×œ ×‘××§×¨××™</p>' +
            '<div class="flex gap-4 mb-6">' +
              '<button onclick="handleRandomCaptains()" class="flex items-center gap-2 bg-purple-500 text-white px-6 py-3 rounded-xl hover:bg-purple-600 transition-all">ğŸ”€ ×”×’×¨×œ ×§×¤×˜× ×™× ×•×§×‘×•×¦×•×ª</button>' +
            '</div>' +
            '<div class="grid grid-cols-2 md:grid-cols-3 gap-3 mb-6">';
      
      gameState.players.filter(p => p.available).forEach(player => {
        const isSelected = state.selectedCaptains.includes(player.id);
        html += '<button onclick="handleToggleCaptain(\'' + player.id + '\')" class="p-4 rounded-xl border-2 transition-all ' + 
          (isSelected ? 'bg-blue-500 text-white border-blue-600 scale-105' : 'bg-gray-50 border-gray-300 hover:border-blue-400') + 
          '">' + player.name + '</button>';
      });
      
      html += '</div>';

      if (selectedCount === 3) {
        html += '<div class="space-y-4 mb-6">' +
          '<h3 class="text-xl font-bold text-gray-800">×”×§×¦×” ×¦×‘×¢×™ ×—×•×œ×¦×•×ª ×œ×§×¤×˜× ×™×</h3>' +
          '<p class="text-sm text-gray-600 mb-4">×œ×—×¥ ×¢×œ ×¦×‘×¢ ×¢×‘×•×¨ ×›×œ ×§×¤×˜×Ÿ</p>';
        
        state.selectedCaptains.forEach(captainId => {
          const captain = gameState.players.find(p => p.id === captainId);
          const assignedColor = state.teamAssignments[captainId];
          html += '<div class="flex items-center gap-4 bg-gray-50 p-4 rounded-xl">' +
            '<span class="font-bold w-32">' + captain.name + '</span>';
          
          if (assignedColor) {
            html += '<span class="text-sm text-gray-600">â†’</span>' +
              '<div class="flex items-center gap-2">' +
                '<div class="w-8 h-8 rounded-full ' + TEAM_COLORS[assignedColor].bg + '"></div>' +
                '<span class="font-medium">' + assignedColor + '</span>' +
              '</div>';
          }
          
          html += '<div class="flex gap-2 mr-auto">';
          
          Object.keys(TEAM_COLORS).forEach(color => {
            const isAssigned = state.teamAssignments[captainId] === color;
            const isUsed = Object.values(state.teamAssignments).includes(color) && !isAssigned;
            html += '<button onclick="handleAssignTeam(\'' + captainId + '\', \'' + color + '\')" ' +
              (isUsed ? 'disabled' : '') +
              ' class="w-16 h-16 rounded-full border-4 transition-all ' + TEAM_COLORS[color].bg + ' ' +
              (isAssigned ? 'border-yellow-400 scale-110 shadow-lg' : 'border-gray-300 opacity-50') + ' ' +
              (isUsed ? 'opacity-30 cursor-not-allowed' : 'hover:scale-105') + '" title="' + color + '"></button>';
          });
          
          html += '</div></div>';
        });
        
        html += '</div>';
      }

      html += '<button onclick="handleFinalizeCaptains()" ' +
        (selectedCount !== 3 || assignedCount !== 3 ? 'disabled' : '') +
        ' class="w-full bg-gradient-to-r from-green-500 to-teal-600 text-white py-4 rounded-xl font-bold text-lg hover:from-green-600 hover:to-teal-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all">×”××©×š ×œ×œ×•×‘×™</button>' +
        '</div></div></div>';

      return html;
    }

    function renderLobby() {
      const myParticipant = gameState.participants.find(p => p.id === state.myId);
      const readyCount = gameState.participants.filter(p => p.ready).length;
      const readyParticipants = gameState.participants.filter(p => p.ready);

      let html = '<div class="min-h-screen bg-gradient-to-br from-blue-500 to-indigo-600 p-4">' +
        '<div class="max-w-2xl mx-auto">' +
          '<div class="bg-white rounded-3xl shadow-2xl p-8">' +
            '<div class="text-center mb-8">' +
              '<div class="text-6xl mb-4">ğŸ‘¥</div>' +
              '<h2 class="text-3xl font-bold text-gray-800 mb-2">×œ×•×‘×™ ×”×“×¨××¤×˜</h2>' +
              '<p class="text-gray-600">××—×›×™× ×œ×©×—×§× ×™×...</p>' +
            '</div>';

      if (!myParticipant) {
        html += '<div class="mb-6">' +
          '<input type="text" id="nicknameInput" placeholder="×”×›× ×¡ ×›×™× ×•×™" class="w-full p-4 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 mb-4" />' +
          '<button onclick="handleJoinLobby()" class="w-full bg-blue-500 text-white py-4 rounded-xl font-bold hover:bg-blue-600 transition-all">×”×¦×˜×¨×£ ×œ×œ×•×‘×™</button>' +
        '</div>';
      }

      html += '<div class="space-y-3 mb-6">';
      gameState.participants.forEach(p => {
        html += '<div class="flex items-center justify-between p-4 rounded-xl ' +
          (p.ready ? 'bg-green-100 border-2 border-green-500' : 'bg-gray-100 border-2 border-gray-300') + '">' +
          '<span class="font-medium">' + p.name + '</span>' +
          (p.ready ? '<span class="text-2xl">âœ“</span>' : '') +
        '</div>';
      });
      html += '</div>';

      if (myParticipant) {
        html += '<button onclick="handleToggleReady()" class="w-full py-4 rounded-xl font-bold mb-4 transition-all ' +
          (myParticipant.ready ? 'bg-gray-300 text-gray-700' : 'bg-green-500 text-white hover:bg-green-600') + '">' +
          (myParticipant.ready ? '×‘×™×˜×•×œ ××•×›×Ÿ' : '×× ×™ ××•×›×Ÿ!') +
        '</button>';
      }

      if (state.isHost && readyCount > 0) {
        html += '<div class="border-t-2 border-gray-200 pt-6 mt-6">' +
          '<h3 class="text-xl font-bold text-gray-800 mb-4">×”×’×“×¨×•×ª ×“×¨××¤×˜</h3>' +
          '<div class="mb-4">' +
            '<button onclick="handleToggleManualOrder()" class="w-full py-3 rounded-xl font-medium transition-all ' +
              (state.manualOrder ? 'bg-purple-500 text-white' : 'bg-gray-200 text-gray-700') + '">' +
              (state.manualOrder ? 'âœ“ ×¡×“×¨ ×™×“× ×™ ×¤×¢×™×œ' : '×¡×“×¨ ××§×¨××™ (×œ×—×¥ ×œ×¡×“×¨ ×™×“× ×™)') +
            '</button>' +
          '</div>';

        if (state.manualOrder && state.draftOrder.length > 0) {
          html += '<div class="bg-gray-50 rounded-xl p-4 mb-4">' +
            '<div class="flex items-center justify-between mb-3">' +
              '<h4 class="font-bold text-gray-700">×¡×“×¨ ×”×‘×—×™×¨×”:</h4>' +
              '<button onclick="handleRandomizeDraftOrder()" class="text-sm bg-purple-100 text-purple-700 px-3 py-1 rounded-lg hover:bg-purple-200">ğŸ”€ ×¢×¨×‘×‘</button>' +
            '</div>' +
            '<div class="space-y-2">';

          state.draftOrder.forEach((participantId, index) => {
            const participant = readyParticipants.find(p => p.id === participantId);
            if (participant) {
              html += '<div class="flex items-center gap-2 bg-white p-3 rounded-lg">' +
                '<span class="font-bold text-lg text-gray-500 w-8">' + (index + 1) + '.</span>' +
                '<span class="flex-1 font-medium">' + participant.name + '</span>' +
                '<div class="flex gap-1">' +
                  '<button onclick="handleMoveDraftOrder(\'' + participantId + '\', -1)" ' +
                    (index === 0 ? 'disabled' : '') +
                    ' class="w-8 h-8 bg-gray-200 rounded hover:bg-gray-300 disabled:opacity-30 disabled:cursor-not-allowed">â†‘</button>' +
                  '<button onclick="handleMoveDraftOrder(\'' + participantId + '\', 1)" ' +
                    (index === state.draftOrder.length - 1 ? 'disabled' : '') +
                    ' class="w-8 h-8 bg-gray-200 rounded hover:bg-gray-300 disabled:opacity-30 disabled:cursor-not-allowed">â†“</button>' +
                '</div>' +
              '</div>';
            }
          });

          html += '</div></div>';
        }

        html += '</div>';
      }

      if (state.isHost) {
        html += '<button onclick="handleStartDraft()" ' +
          (readyCount === 0 ? 'disabled' : '') +
          ' class="w-full bg-gradient-to-r from-orange-500 to-red-600 text-white py-4 rounded-xl font-bold text-lg hover:from-orange-600 hover:to-red-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center justify-center gap-2">â–¶ï¸ ×”×ª×—×œ ×“×¨××¤×˜ (' + readyCount + ' ××•×›× ×™×)</button>';
      }

      html += '</div></div></div>';
      return html;
    }

    function renderDrafting() {
      const turnInfo = getCurrentTurnInfo();
      
      let html = '<div class="min-h-screen bg-gradient-to-br from-green-600 to-teal-600 p-4">' +
        '<div class="max-w-6xl mx-auto">';

      if (turnInfo) {
        html += '<div class="mb-6 p-6 rounded-3xl shadow-xl ' +
          (turnInfo.isMyTurn ? 'bg-yellow-400 animate-pulse' : 'bg-white') + '">' +
          '<div class="text-center">' +
            '<p class="text-2xl font-bold mb-2">' +
              (turnInfo.isMyTurn ? 'ğŸ”¥ ×”×ª×•×¨ ×©×œ×š ×œ×‘×—×•×¨! ğŸ”¥' : 'â³ ×”×ª×•×¨ ×©×œ: ' + turnInfo.participant.name) +
            '</p>' +
            '<p class="text-lg text-gray-700 font-medium">×‘×•×—×¨ ×¢×‘×•×¨ ×§×‘×•×¦×”: <span class="font-bold">' + turnInfo.team.name + '</span></p>' +
          '</div>' +
        '</div>';
      }

      html += '<div class="bg-white rounded-3xl shadow-2xl p-6 mb-6">' +
        '<h3 class="text-2xl font-bold text-gray-800 mb-4">×©×—×§× ×™× ×–××™× ×™×</h3>' +
        '<div class="grid grid-cols-2 md:grid-cols-4 gap-3">';

      gameState.players.filter(p => p.available).forEach(player => {
        const canPick = turnInfo && turnInfo.isMyTurn;
        html += '<button onclick="handleMakePick(\'' + player.id + '\')" ' +
          (!canPick ? 'disabled' : '') +
          ' class="p-4 rounded-xl border-2 transition-all ' +
          (canPick ? 'bg-gradient-to-br from-blue-400 to-purple-500 text-white border-purple-600 hover:scale-105 cursor-pointer' : 'bg-gray-100 text-gray-500 border-gray-300 cursor-not-allowed') +
          '">' + player.name + '</button>';
      });

      html += '</div></div><div class="grid md:grid-cols-3 gap-4 mb-6">';

      gameState.teams.forEach(team => {
        html += '<div class="bg-white rounded-3xl shadow-xl p-6">' +
          '<div class="w-12 h-12 rounded-full ' + TEAM_COLORS[team.name].bg + ' mx-auto mb-3"></div>' +
          '<h3 class="text-xl font-bold text-center mb-2">' + team.name + '</h3>' +
          '<p class="text-sm text-gray-600 text-center mb-4">×§×¤×˜×Ÿ: ' + team.captain + '</p>' +
          '<div class="space-y-2">';
        
        team.players.forEach(player => {
          html += '<div class="bg-gray-100 p-2 rounded-lg text-center text-sm">' + player + '</div>';
        });
        
        html += '</div></div>';
      });

      html += '</div>';

      if (state.isHost) {
        html += '<button onclick="handleResetDraft()" class="w-full bg-red-500 text-white py-3 rounded-xl font-bold hover:bg-red-600 transition-all flex items-center justify-center gap-2">ğŸ”„ ××¤×¡ ×“×¨××¤×˜</button>';
      }

      html += '</div></div>';
      return html;
    }

    function renderCompleted() {
      let html = '<div class="min-h-screen bg-gradient-to-br from-yellow-400 to-orange-500 p-4">' +
        '<div class="max-w-4xl mx-auto">' +
          '<div class="bg-white rounded-3xl shadow-2xl p-8 mb-6">' +
            '<div class="text-center mb-8">' +
              '<div class="text-7xl mb-4 animate-bounce">ğŸ†</div>' +
              '<h2 class="text-4xl font-bold text-gray-800 mb-2">×”×“×¨××¤×˜ ×”×¡×ª×™×™×!</h2>' +
              '<p class="text-gray-600">×”× ×” ×”×§×‘×•×¦×•×ª ×©×œ×›×</p>' +
            '</div>' +
            '<div class="grid md:grid-cols-3 gap-6 mb-8">';

      gameState.teams.forEach(team => {
        html += '<div class="bg-gradient-to-br from-gray-50 to-gray-100 rounded-2xl p-6 border-4 border-gray-300">' +
          '<div class="w-16 h-16 rounded-full ' + TEAM_COLORS[team.name].bg + ' mx-auto mb-4"></div>' +
          '<h3 class="text-2xl font-bold text-center mb-3">' + team.name + '</h3>' +
          '<div class="bg-yellow-100 border-2 border-yellow-400 rounded-lg p-3 mb-4">' +
            '<p class="text-center font-bold text-yellow-800">ğŸ‘‘ ' + team.captain + '</p>' +
          '</div>' +
          '<div class="space-y-2">';
        
        team.players.filter(p => p !== team.captain).forEach(player => {
          html += '<div class="bg-white p-3 rounded-lg text-center border border-gray-200">' + player + '</div>';
        });
        
        html += '</div></div>';
      });

      html += '</div><div class="space-y-4">' +
        '<button onclick="handleShareWhatsApp()" class="w-full bg-green-500 text-white py-4 rounded-xl font-bold text-lg hover:bg-green-600 transition-all flex items-center justify-center gap-2">ğŸ“¤ ×©×ª×£ ×‘×•×•××˜×¡××¤</button>';

      if (state.isHost) {
        html += '<button onclick="handleResetDraft()" class="w-full bg-gray-500 text-white py-3 rounded-xl font-bold hover:bg-gray-600 transition-all flex items-center justify-center gap-2">ğŸ”„ ×”×ª×—×œ ×“×¨××¤×˜ ×—×“×©</button>';
      }

      html += '</div></div></div></div>';
      return html;
    }

    window.handleInitGame = function() {
      state.playerInput = document.getElementById('playerInput').value;
      initializeGame();
    };

    window.handleToggleCaptain = function(playerId) {
      toggleCaptain(playerId);
    };

    window.handleRandomCaptains = function() {
      selectCaptainsRandomly();
    };

    window.handleAssignTeam = function(captainId, color) {
      assignTeam(captainId, color);
    };

    window.handleFinalizeCaptains = function() {
      finalizeCaptains();
    };

    window.handleJoinLobby = function() {
      state.nickname = document.getElementById('nicknameInput').value;
      joinLobby();
    };

    window.handleToggleReady = function() {
      toggleReady();
    };

    window.handleStartDraft = function() {
      startDraft();
    };

    window.handleMakePick = function(playerId) {
      makePick(playerId);
    };

    window.handleResetDraft = function() {
      resetDraft();
    };

    window.handleShareWhatsApp = function() {
      shareOnWhatsApp();
    };

    window.handleToggleManualOrder = function() {
      toggleManualOrder();
    };

    window.handleMoveDraftOrder = function(participantId, direction) {
      moveDraftOrder(participantId, direction);
    };

    window.handleRandomizeDraftOrder = function() {
      randomizeDraftOrder();
    };

    init();
  </script>
</body>
</html>
